<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="parserColorBackground.MainPage"
             Title="Color Background Parser">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <Label 
                Text="Управление приложением"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center"
                Margin="0,0,0,10"/>

            <!-- SQL Query TextField -->
            <Frame 
                BorderColor="LightGray"
                CornerRadius="10"
                Padding="10"
                HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="SQL Запрос:"
                        FontSize="16"
                        FontAttributes="Bold"/>

                    <Editor 
                        x:Name="SqlQueryEditor"
                        Placeholder="SELECT * FROM ColorOptions&#x0a;SELECT * FROM SplashOptions"
                        HeightRequest="100"
                        FontSize="14"
                        AutoSize="TextChanges"/>

                    <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="10">
                        <Button 
                            Grid.Column="0"
                            Text="▶ Выполнить SQL"
                            Clicked="OnExecuteSqlClicked"
                            BackgroundColor="#9C27B0"
                            TextColor="White"
                            CornerRadius="8"/>

                        <Button 
                            Grid.Column="1"
                            Text="📝 Примеры SQL"
                            Clicked="OnShowSqlExamplesClicked"
                            BackgroundColor="#2196F3"
                            TextColor="White"
                            CornerRadius="8"/>

                        <Button 
                            Grid.Column="2"
                            Text="🗑️"
                            Clicked="OnClearSqlClicked"
                            BackgroundColor="#F44336"
                            TextColor="White"
                            CornerRadius="8"
                            WidthRequest="50"/>
                    </Grid>

                    <Frame 
                        x:Name="SqlResultFrame"
                        IsVisible="False"
                        BorderColor="LightBlue"
                        CornerRadius="5"
                        Padding="10"
                        BackgroundColor="#F0F8FF">
                        <ScrollView MaximumHeightRequest="150">
                            <Label 
                                x:Name="SqlResultLabel"
                                FontSize="12"
                                FontFamily="Courier"
                                TextColor="#333"/>
                        </ScrollView>
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <!-- Кнопки выбора -->
            <Button 
                x:Name="AlertButton"
                Text="🎨 Выбрать цвет фона (Alert)"
                FontSize="18"
                Clicked="OnAlertButtonClicked"
                BackgroundColor="{StaticResource Primary}"
                TextColor="White"
                CornerRadius="10"
                HeightRequest="60"/>

            <Button 
                x:Name="AddColorButton"
                Text="➕ Добавить новый цвет фона"
                FontSize="16"
                Clicked="OnAddColorClicked"
                BackgroundColor="#00BCD4"
                TextColor="White"
                CornerRadius="10"
                HeightRequest="50"/>

            <Button 
                x:Name="SplashButton"
                Text="🖼️ Выбрать заставку (Alert)"
                FontSize="18"
                Clicked="OnSplashButtonClicked"
                BackgroundColor="#FF9800"
                TextColor="White"
                CornerRadius="10"
                HeightRequest="60"/>

            <Button 
                x:Name="AddSplashButton"
                Text="➕ Добавить новую заставку"
                FontSize="16"
                Clicked="OnAddSplashClicked"
                BackgroundColor="#4CAF50"
                TextColor="White"
                CornerRadius="10"
                HeightRequest="50"/>

            <Button 
                Text="🔍 Диагностика БД"
                Clicked="OnDiagnosticClicked"
                BackgroundColor="#607D8B"
                TextColor="White"
                CornerRadius="8"
                Margin="0,10,0,0"/>

            <Label 
                x:Name="SelectedColorLabel"
                Text="Цвет не выбран"
                FontSize="16"
                HorizontalOptions="Center"
                TextColor="Gray"/>

            <Label 
                x:Name="SelectedSplashLabel"
                Text="Заставка не выбрана"
                FontSize="16"
                HorizontalOptions="Center"
                TextColor="Gray"/>

            <!-- JINT Console Output -->
            <Frame 
                x:Name="JintConsoleFrame"
                IsVisible="False"
                BorderColor="#9C27B0"
                CornerRadius="8"
                Padding="10"
                BackgroundColor="#F3E5F5"
                HasShadow="True">
                <VerticalStackLayout Spacing="5">
                    <Label 
                        Text="🔧 JINT Console:"
                        FontSize="14"
                        FontAttributes="Bold"
                        TextColor="#9C27B0"/>
                    <ScrollView MaximumHeightRequest="100">
                        <Label 
                            x:Name="JintConsoleLabel"
                            FontSize="12"
                            FontFamily="Courier"
                            TextColor="#4A148C"/>
                    </ScrollView>
                </VerticalStackLayout>
            </Frame>

            <!-- Предпросмотр (ВАЖНО: этот элемент был пропущен!) -->
            <Frame 
                x:Name="PreviewFrame"
                HeightRequest="200"
                CornerRadius="15"
                HasShadow="True"
                BorderColor="LightGray">
                <Label 
                    Text="Предпросмотр фона"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    FontSize="18"/>
            </Frame>

            <!-- Переключатель режима просмотра -->
            <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                <Label 
                    Text="Режим просмотра:"
                    FontSize="16"
                    VerticalOptions="Center"/>
                <Button 
                    x:Name="ViewModeButton"
                    Text="📸 Фоны"
                    Clicked="OnViewModeClicked"
                    BackgroundColor="#4CAF50"
                    TextColor="White"
                    CornerRadius="8"/>
            </HorizontalStackLayout>

            <!-- Список изображений -->
            <Label 
                x:Name="CollectionTitleLabel"
                Text="Изображения фонов"
                FontSize="18"
                FontAttributes="Bold"
                HorizontalOptions="Center"
                Margin="0,10,0,0"/>

            <CollectionView 
                x:Name="ImagesCollectionView"
                SelectionMode="Single"
                SelectionChanged="OnImageSelected">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="10"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="5" CornerRadius="10" HasShadow="True" BackgroundColor="White">
                            <!-- ИСПРАВЛЕНИЕ: Добавляем Grid с Tap жестом -->
                            <Grid>
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnImageTapped" />
                                </Grid.GestureRecognizers>

                                <Grid RowDefinitions="150,Auto">
                                    <!-- Изображение -->
                                    <Image 
                                        Grid.Row="0"
                                        Source="{Binding ImageUrl}"
                                        Aspect="AspectFill"
                                        HeightRequest="150"/>

                                    <!-- Подпись -->
                                    <Label 
                                        Grid.Row="1"
                                        Text="{Binding Title}"
                                        BackgroundColor="#80000000"
                                        TextColor="White"
                                        Padding="10,5"
                                        FontSize="14"
                                        HorizontalOptions="Fill"/>
                                </Grid>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <ActivityIndicator 
                x:Name="LoadingIndicator"
                IsRunning="False"
                IsVisible="False"
                Color="{StaticResource Primary}"
                VerticalOptions="Center"
                HorizontalOptions="Center"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>